<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:fragment="head">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>split.it</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/split-custom.css">
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico">
    <meta name="theme-color" content="#fff">
</head>
<body>
    <header th:fragment="header">
        <!-- Barra de navegación -->
        <div class="navbar container">
            <!-- Logo -->
            <a href="/mi-espacio" class="logo" title="split.it"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 49 16"><path d="M34.27 10.22c-.75 0-1.38.54-1.53 1.34-.2 1 .34 1.33 1.03 1.33.8 0 1.4-.58 1.54-1.32.16-.83-.2-1.35-1.04-1.35zM44.81 2.02l-.38 2h-1.4l-.4 2.09h1.4l-.35 1.87h2.38l.36-1.87h1.54l.39-2.09h-1.54l.39-2H44.8zm-1.88 6.75-.75 3.96h2.39l.74-3.96h-2.38zM41.12 0c-.97 0-1.54.55-1.67 1.22-.16.86.36 1.24 1.2 1.24.95 0 1.52-.58 1.65-1.24C42.46.39 41.92 0 41.12 0zm-1.96 4.02-.75 3.95h2.38l.75-3.95h-2.38zm-1.5 4.75-.75 3.96h2.38l.75-3.96h-2.38zM30.3 2.02l-.37 2h-1.4l-.4 2.09h1.4l-.36 1.87h2.4l.34-1.87h1.54l.4-2.09H32.3l.38-2H30.3zm-1.87 6.75-.76 3.96h2.4l.74-3.96h-2.38zM26.6 0c-.97 0-1.53.56-1.65 1.22-.17.87.36 1.24 1.2 1.24.94 0 1.52-.58 1.64-1.24C27.95.39 27.42 0 26.61 0zm-1.94 4.02-.76 3.95h2.39l.75-3.95h-2.38zm-1.5 4.75-.76 3.96h2.39l.75-3.96h-2.38zM20.6.9l-1.34 7.07h2.38L22.98.91H20.6zm-2.09 7.87-.75 3.96h2.38l.75-3.96h-2.38zM14.94 3.87c-.79 0-1.86.3-2.62 1.01l.12-.86h-2.26l-.75 3.95h2.32c.22-1.16 1-2.09 2.2-2.09 1.06 0 1.63.83 1.4 2.09h-.01 2.32c.46-2.4-.72-4.1-2.72-4.1zm-6.26 4.9L7.31 16h2.4l.77-4.08c.4.52 1.15.94 2.13.94 2.12 0 3.87-1.8 4.3-4.09H14.6c-.24 1.25-1.1 2.08-2.18 2.08-1.16 0-1.63-.89-1.4-2.08H8.67zM5.47 3.86c-1.58 0-3.33.92-3.62 2.44-.14.78.07 1.3.45 1.67h5.04C6.34 7 4 7.12 4.18 6.18c.09-.45.55-.6 1.04-.6.73 0 1.47.52 1.79.88l1.51-1.4c-.98-1.1-2.49-1.2-3.05-1.2zM1.56 8.77c1.02 1 3.25.91 3.1 1.75-.1.5-.64.63-1 .63-.42 0-1.34-.1-1.98-.9L0 11.52c.32.49 1.17 1.36 3.2 1.36 2.05 0 3.51-1.19 3.78-2.6.13-.7-.05-1.16-.39-1.5H1.56z"/></svg></a>
            <!-- Enlaces de navegación -->
            <nav>
                <a href="/mi-espacio" class="header-link" style="margin-right: 60px;">Mi espacio</a>
                <a href="/mis-grupos" class="header-link">Mis grupos</a>
            </nav>
            <!-- Usuario -->
            <div class="d-flex">
                <div th:unless="${#lists.isEmpty(notificaciones)}" class="dropdown me-2">
                    <button class="btn btn-round btn-white header-link dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="i i-bell" viewBox="0 0 16 16">
                            <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5 5 0 0 1 13 6c0 .88.32 4.2 1.22 6"/>
                        </svg><span class="visually-hidden">Notificaciones</span></button>
                    <ul class="dropdown-menu not-dropdown dropdown-menu-end">
                        <li th:each="notificacion : ${notificaciones}">
                            <p class="dropdown-item-text m-0 pb-0" th:utext="${notificacion.mensaje}">Notificación</p>
                            <small class="dropdown-item-text m-0"><span th:text="${notificacion.pago.grupo}">Grupo</span><a th:if="${notificacion.tipo == 1 && !notificacion.confirmando}" th:attr="onclick=|confirm(${notificacion.id})|" style="cursor: pointer;"> · Confirmar pago</a><span th:if="${notificacion.tipo == 1 && notificacion.confirmando}"> · Confirmando pago</span><a th:if="${notificacion.tipo == 2}" th:attr="onclick=|confirmPago(${notificacion.id})|" style="cursor: pointer;"> · Confirmar recepción del pago</a></small>
                        </li>
                    </ul>
                </div>
                <div class="dropdown">
                    <button class="btn btn-white header-link dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="i i-user" viewBox="0 0 16 16">
                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
                            <path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1" />
                        </svg><span th:text="${usuario.nombre}">Usuario</span></button>
                    <ul class="dropdown-menu acc-dropdown dropdown-menu-end">
                        <li><a href="/mi-cuenta">Mi cuenta</a></li>
                        <li>
                            <form th:action="@{/logout}" method="post">
                                <button type="submit" style="cursor: pointer; color: #dc3545;">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="i i-logout" viewBox="0 0 16 16">
                                        <path d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0z" />
                                        <path d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z" />
                                    </svg>Cerrar sesión</button>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </header>
    <div th:fragment="toasts" aria-live="polite" aria-atomic="true" class="position-relative">
        <div class="toast-container position-fixed bottom-0 end-0 p-5">
            <div th:each="toast : ${toasts}" class="toast show" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="false">
                <div class="toast-header">
                    <strong class="me-auto" th:text="${toast.pago.grupo} + ' se ha saldado'">Grupo</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Cerrar" th:attr="onclick=|closeToast(${toast.id})|" ></button>
                </div>
                <div class="toast-body"  th:utext="${toast.mensaje}">Mensaje</div>
            </div>
        </div>
    </div>
    <script th:fragment="toasts-js" th:inline="javascript">
        document.addEventListener('DOMContentLoaded', () => {
            window.closeToast = function(id) {
                const csrfToken = [[${ _csrf.token }]];
                fetch(`/notificaciones/` + id, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': csrfToken
                    },
                    body: JSON.stringify({ leido: true })
                });
            }

            window.confirm = function(id) {
                const csrfToken = [[${ _csrf.token }]];
                fetch(`/notificaciones/` + id + `/confirmar`, {
                    method: 'PUT',
                    headers: {
                        'X-CSRF-TOKEN': csrfToken
                    }
                });
            }

            window.confirmPago = function(id) {
                const csrfToken = [[${ _csrf.token }]];
                fetch(`/notificaciones/` + id + `/confirmar-pago`, {
                    method: 'PUT',
                    headers: {
                        'X-CSRF-TOKEN': csrfToken
                    }
                });
            }
        });
    </script>
</body>
</html>